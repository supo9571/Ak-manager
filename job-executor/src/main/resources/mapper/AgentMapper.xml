<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.job.executor.mapper.AgentMapper">

    <select id="selectUids" resultType="com.job.executor.domain.AgentCommission">
        select r.uid, r.agent_id agentId, r.channel , c.time endTime
        from data_register r
        left join agent_commission c
        on r.uid = c.uid
    </select>

    <insert id="saveAgentIncome">
        insert into agent_commission(uid,agent_id,channel,team_num,sub_num,sub_ratio,sub_income,other_num,other_ratio,other_income,total_income,time) values
        <foreach item="item" index="index" collection="list" separator=",">
            (#{item.uid},#{item.agentId},#{item.channel},#{item.teamNum},#{item.subNum},#{item.subRatio},#{item.subIncome}
            ,#{item.otherNum},#{item.otherRatio},#{item.otherIncome},#{item.totalIncome},#{item.endTime})
        </foreach>
        ON DUPLICATE KEY
        UPDATE agent_id=values(agent_id),
        channel=values(channel),
        team_num=values(team_num),
        sub_num=values(sub_num),
        sub_ratio=sub_ratio+values(sub_ratio),
        sub_income=sub_income+values(sub_income),
        other_num=other_num+values(other_num),
        other_ratio=other_ratio+values(other_ratio),
        other_income=other_income+values(other_income),
        total_income=total_income+values(total_income),
        `time`=values(`time`);
    </insert>

</mapper>
